import random
from games.base import BaseGame
from config import Config

class IQGame(BaseGame):
    def __init__(self, db, theme="light"):
        super().__init__(db, theme)
        self.game_name = "لعبة الذكاء"
        self.questions = [
            {"q": "ما الشيء الذي يمشي بلا أرجل ويبكي بلا عيون؟", "a": ["السحاب", "الغيم", "السحب"], "h": "موجود في السماء"},
            {"q": "ما الشيء الذي له رأس ولا عين له؟", "a": ["الدبوس", "المسمار", "الابره", "الإبرة"], "h": "يستخدم للتثبيت"},
            {"q": "ما الشيء الذي يكتب ولا يقرأ؟", "a": ["القلم", "الريشه", "الريشة"], "h": "أداة كتابة"},
            {"q": "ما الشيء الذي له أسنان ولا يعض؟", "a": ["المشط", "المنشار"], "h": "يستخدم للشعر"},
            {"q": "ما الشيء الذي يجري ولا يمشي؟", "a": ["الماء", "النهر", "الوادي"], "h": "سائل"},
            {"q": "كلي ثقوب ومع ذلك أحفظ الماء؟", "a": ["الاسفنج", "الإسفنج", "اسفنج"], "h": "للتنظيف"},
            {"q": "ما الشيء الذي إذا أخذت منه كبر وإذا أضفت له صغر؟", "a": ["الحفره", "الحفرة", "حفره"], "h": "في الأرض"},
            {"q": "ما الشيء الذي كلما زاد نقص؟", "a": ["العمر", "الوقت", "الزمن"], "h": "يمر"},
            {"q": "ما هو الشيء الذي تراه في الليل ثلاث مرات وفي النهار مرة واحدة؟", "a": ["اللام", "حرف اللام", "ل"], "h": "حرف"},
            {"q": "أخت خالك وليست خالتك؟", "a": ["امك", "أمك", "امي", "أمي", "الام", "الأم"], "h": "قريب جدا"},
            {"q": "ما هو الشيء الذي يوجد في وسط باريس؟", "a": ["الراء", "حرف الراء", "ر"], "h": "حرف في الاسم"},
            {"q": "شيء موجود في السماء إذا أضفت له حرفا أصبح في الأرض؟", "a": ["نجم", "نجوم"], "h": "يضيء ليلا"},
            {"q": "ما الشيء الذي يقرصك ولا تراه؟", "a": ["الجوع", "جوع"], "h": "إحساس"},
            {"q": "له عين ولا يرى؟", "a": ["الابره", "الإبرة", "ابره"], "h": "للخياطة"},
            {"q": "ما الشيء الذي إذا لمسته صاح؟", "a": ["الجرس", "جرس"], "h": "يصدر صوت"},
            {"q": "ما الشيء الذي له أربع أرجل ولا يستطيع المشي؟", "a": ["الكرسي", "الطاوله", "الطاولة", "السرير"], "h": "أثاث"},
            {"q": "أنا ابن الماء فإن تركوني في الماء مت؟", "a": ["الثلج", "ثلج"], "h": "بارد"},
            {"q": "ما الشيء الذي يسير أمامك ولا تراه؟", "a": ["الهواء", "هواء", "الريح"], "h": "تحسه"},
            {"q": "حيوان يحك أذنه بأنفه؟", "a": ["الفيل", "فيل"], "h": "كبير جدا"},
            {"q": "ما الشيء الذي تحمله ويحملك؟", "a": ["الحذاء", "الحذا", "النعل"], "h": "في القدم"},
            {"q": "ما هو البيت الذي ليس له أبواب ولا نوافذ؟", "a": ["بيت الشعر", "القصيده", "القصيدة"], "h": "أدبي"},
            {"q": "له رقبة ولا رأس له؟", "a": ["الزجاجه", "الزجاجة", "القاروره", "القارورة"], "h": "تحفظ السوائل"},
            {"q": "ما الشيء الذي يسمع بلا أذن ويتكلم بلا لسان؟", "a": ["التلفون", "الهاتف", "الجوال"], "h": "للاتصال"},
            {"q": "ما الشيء الذي إذا غليته جمد؟", "a": ["البيض", "بيض"], "h": "طعام"},
            {"q": "أرى كل شيء وليس لي عيون؟", "a": ["المرآه", "المرآة", "المرايا"], "h": "انعكاس"},
            {"q": "من هو الخال الوحيد لأولاد عمتك؟", "a": ["ابوك", "أبوك", "والدك", "ابي", "أبي"], "h": "قريب جدا"},
            {"q": "ما الشيء الذي يدخل مبلولا ويخرج ناشفا؟", "a": ["الخبز", "خبز", "العيش"], "h": "في الفرن"},
            {"q": "حامل ومحمول نصفه ناشف ونصفه مبلول؟", "a": ["السفينه", "السفينة", "المركب"], "h": "في البحر"},
            {"q": "ما الشيء الذي لا يدخل إلا إذا ضرب على رأسه؟", "a": ["المسمار", "الدبوس"], "h": "للتثبيت"},
            {"q": "ما الشيء الذي كلما أخذت منه كبر؟", "a": ["الحفره", "الحفرة", "حفره"], "h": "في الأرض"}
        ]
        random.shuffle(self.questions)
        self.used = []
    
    def get_question(self):
        q_data = self.questions[self.current_q - 1]
        self.current_answer = q_data["a"]
        return self.build_question_flex(q_data["q"], q_data["h"])
    
    def check_answer(self, answer: str) -> bool:
        normalized = Config.normalize(answer)
        return any(normalized == Config.normalize(ans) for ans in self.current_answer)
